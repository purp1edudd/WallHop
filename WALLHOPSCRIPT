local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Переменная для включения/выключения функции
local enabled = true

-- Создаем GUI-индикатор
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ToggleStatusGui"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(0, 120, 0, 40)
StatusLabel.Position = UDim2.new(0, 10, 0, 10)
StatusLabel.BackgroundColor3 = Color3.new(0, 1, 0)  -- зеленый для включено
StatusLabel.TextColor3 = Color3.new(1, 1, 1)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextScaled = true
StatusLabel.Text = "ENABLED"
StatusLabel.Parent = ScreenGui

local function updateStatus()
    if enabled then
        StatusLabel.Text = "ENABLED"
        StatusLabel.BackgroundColor3 = Color3.new(0, 1, 0)
    else
        StatusLabel.Text = "DISABLED"
        StatusLabel.BackgroundColor3 = Color3.new(1, 0, 0)
    end
end

updateStatus()

-- Обработка нажатия клавиши M
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.M then
        enabled = not enabled
        updateStatus()
        
        -- Когда меняем состояние — сразу меняем статы у хуманоида
        local character = LocalPlayer.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                if enabled then
                    -- Пример: включаем прыжок и ходьбу
                    humanoid.WalkSpeed = 16
                    humanoid.JumpPower = 50
                else
                    -- Пример: выключаем (ставим ходьбу и прыжок в 0)
                    humanoid.WalkSpeed = 0
                    humanoid.JumpPower = 0
                end
            end
        end
    end
end)

-- Также следим за появлением персонажа, чтобы применить текущий статус при спавне
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        if player == LocalPlayer then
            local humanoid = character:WaitForChild("Humanoid")
            if enabled then
                humanoid.WalkSpeed = 16
                humanoid.JumpPower = 50
            else
                humanoid.WalkSpeed = 0
                humanoid.JumpPower = 0
            end
        end
    end)
end)

-- Если персонаж уже есть, сразу применяем статус
if LocalPlayer.Character then
    local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        if enabled then
            humanoid.WalkSpeed = 16
            humanoid.JumpPower = 50
        else
            humanoid.WalkSpeed = 0
            humanoid.JumpPower = 0
        end
    end
end
